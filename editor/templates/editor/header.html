<!DOCTYPE html>

<head>
	<title>NITJ Compiler</title>
	{% load staticfiles %}
	<link rel='stylesheet' href="{% static 'css/bootstrap.min.css' %}" type='text/css'/>
	<script src="{% static 'js/codemirror.js' %}"></script>
	<script src="{% static 'mode/clike/clike.js' %}" type="text/javascript"></script>
	<script src="{% static 'mode/python/python.js' %}" type="text/javascript"></script>

	<script src="{% static 'js/jquery-3.1.1.js' %}"></script>

	<link href="{% static 'css/codemirror.css' %}" rel="stylesheet" type="text/css"/>
	<link href="{% static 'theme/default.css' %}" rel="stylesheet" type="text/css"/>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script>
		function showStdin() {
			//toggle stdin response windows
			var inpLabel = document.getElementById('inputLabel');
			var stdinput = document.getElementById('stdinput');
			if (inpLabel.style.display === 'none') {
				inpLabel.style.display = 'block';
				stdinput.style.display = 'block';
			} else {
				inpLabel.style.display = 'none';
				stdinput.style.display = 'none';
				stdinput.value = "";
			}
		}

		$(function () {
			//jquery that compiles code at the server by sending UI Data and outputting the response
			$('#execute').click(function () {
				var sourceCode = editor.getValue();
				var sourceLang = document.getElementById("languageSelect").value;
				var sourceInp = document.getElementById("stdinput").value;
				var sourceName = document.getElementById("fname").value;
				if (sourceName == "") {
					console.log("empty source");
					sourceName = "main";
				}
				$.ajax({
					method: 'POST',
					url: "execute",
					data: {
						'sourceCode': sourceCode,
						'sourceLang': sourceLang,
						'sourceInp': sourceInp,
						'sourceName': sourceName
					},
					success: function (data) {
						//this gets called when server returns an OK response
						displayOutput(data);
					},
					error: function (data) {
						alert("Error occured during submission. Try again later");
					}
				});

			});
		});

		function displayOutput(data) {
			//display output
			document.getElementById('output').style.display = "block";
			document.getElementById('stdoutput').style.display = "block";
			document.getElementById('stdoutput').value = data;
		}

		function copyText() {}

		var resetCode = function () {
			//clear code and set it to whatever language currently exists
			document.getElementById("languageSelect").onchange();
		}

		var openFile = function (event) {
			// button that browses file and pastes content into editor
			var input = event.target;
			var reader = new FileReader();
			reader.onload = function () {
				var text = reader.result;
				displayContents(text, input.files[0].name)
			};
			reader.readAsText(input.files[0]);
		};

		var displayContents = function (file_text, file_name) {
			//Display the loaded file from the client onto the browser
			editor.setValue(file_text);
			document.getElementById("fname").value = file_name;
		}
	</script>

	<style>
		.CodeMirror {
			border: 1px solid #334;
			width: 800px;
			height: 350px;
		}

		body {
			background-color: black;
			padding: 2px 200px;
		}

		#header {
			color: white;
			text-align: center;
		}

		#outer {
			width: 800px;
			background-color: gray;
			height: 45px;
			padding: 10px;
		}

		.inner {
			display: inline-block;
		}

	</style>
</head>

<body>
	<div>
		{% block content %}{% endblock %}
	</div>
</body>

</html>
